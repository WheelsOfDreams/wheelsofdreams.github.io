YUI.add("flickr-carousel-gallery",function(e,t){var n=e.Lang.sub;e.FlickrCarouselGallery=new e.Base.create("gallery-flickr-carousel-gallery",e.Base,[],{_flickrPhotoSetInfoUrl:"http://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos&api_key={apiKey}&photoset_id={photosetId}&extras=url_q&format=json",photoGridItemTemplate:'<div class="galleryPhoto yui3-gallery-flickr-carousel-gallery-item" data-photosetId="{photosetId}"><img src="{imgSrc}" width="{width}" height="{height}"/><h3>{title}</h3></div>',carouselWrapperTemplate:'<div class="yui3-gallery-flickr-carousel-gallery-carousel"></div>',initializer:function(){this.get("galleryNode").addClass("yui3-gallery-flickr-carousel-gallery"),this.bindUI(),this.fetchPhotoSetInfo(this.get("apiKey"),this.get("photosetIds"))},fetchPhotoSetInfo:function(t,n){e.Array.each(n,function(e){this.makeFlickrAPICall(this._flickrPhotoSetInfoUrl,{apiKey:t,photosetId:e.id},this._handlePhotoSetInfoResponse)},this)},makeFlickrAPICall:function(t,r,i){t=n(t,r),t+="&jsoncallback={callback}",e.jsonp(t,e.bind(i,this))},addThumbnailToDOM:function(t){var r=this.get("sets")[t-1],i=r.photoset.id,s=this._findPrimaryImage(r),o;e.Array.some(this.get("photosetIds"),function(e){if(i==e.id)return o=e.title,!0}),this.get("galleryNode").append(n(this.photoGridItemTemplate,{imgSrc:s,width:"150px",height:"150px",title:o,photosetId:i}))},_findPrimaryImage:function(t){var n=t.photoset,r=n.primary,i;return e.Array.some(n.photo,function(e){if(r==e.id)return i=e.url_q,!0}),i},_showCarousel:function(t){var n=this.get("activeCarousel"),r=this.get("carouselNode"),i,s;r.setHTML(this.carouselWrapperTemplate),i=r.one(".yui3-gallery-flickr-carousel-gallery-carousel"),s=new e.FlickrCarousel(e.mix({srcNode:i,apiKey:this.get("apiKey"),photosetId:t.currentTarget.getData("photosetId")},this.get("carouselConfig"))),this.set("activeCarousel",s)},_handlePhotoSetInfoResponse:function(e){this.addThumbnailToDOM(this.get("sets").push(e))},bindUI:function(){var e=this.get("_events"),t=this.get("galleryNode");e.push(t.delegate("click",this._showCarousel,".galleryPhoto",this))},destructor:function(){this.get("_events").each(function(e){e.detach()})}},{ATTRS:{galleryNode:{},carouselNode:{},activeCarousel:{},apiKey:{},photosetIds:[],carouselConfig:{value:{}},sets:{value:[]},_events:{value:[]}}})},"@VERSION@",{requires:["base","base-build","jsonp","event"],skinnable:!1});
