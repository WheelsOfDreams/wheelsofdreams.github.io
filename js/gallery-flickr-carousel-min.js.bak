YUI.add("gallery-flickr-carousel",function(e,t){var n=e.Lang.sub;e.FlickrCarousel=new e.Base.create("gallery-flickr-carousel",e.ScrollView,[],{_flickrUrl:"http://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos&api_key={apiKey}&photoset_id={photosetId}&extras={size},description&format=json",imageCarouselTemplate:"<ul/>",imageTemplate:'<li class="img-container" style="width: {width}"><div class="image-wrapper"><img src="{src}" alt="{title}" width="{imgWidth}" height="{imgHeight}" />{prevNavTemplate}{nextNavTemplate}</div>{descriptionTemplate}</li>',prevNavTemplate:'<div class="navigate prev" style="height: {height}"></div>',nextNavTemplate:'<div class="navigate next" style="height: {height}"></div>',descriptionTemplate:'<div class="description">{description}</div>',_photoSizeToKeyUrl:[{key:"sq",x:75,y:75},{key:"t",x:100,y:75},{key:"q",x:150,y:150},{key:"s",x:240,y:180},{key:"n",x:320,y:240},{key:"m",x:500,y:375},{key:"z",x:640,y:480},{key:"c",x:800,y:600},{key:"l",x:1024,y:768},{key:"o",x:2400,y:1800}],initializer:function(t){this.plug(e.Plugin.ScrollViewPaginator,{selector:"li"}),this.determinePhotoSize(),this.fetchCarouselImages(t.apiKey,t.photosetId)},determinePhotoSize:function(){var t=parseInt(this.get("width"),10),n=this._photoSizeToKeyUrl,r,i;e.Array.some(n,function(e){if(e.x>=t)return r=e.key,i=e,!0},this),r||(r=n[n.length].key),this.set("_photoSizeParam",r),this.set("photoSize",i)},fetchCarouselImages:function(t,r){var i=n(this._flickrUrl,{apiKey:t,photosetId:r,size:this.get("_photoSizeParam")});i+="&jsoncallback={callback}",e.jsonp(i,e.bind(this._handleResponse,this))},_handleCarouselNavigate:function(e){var t=this.pages;e.currentTarget.hasClass("next")===!0?t.next():t.prev()},_advanceImage:function(){var e=this.pages,t=e.get("index");t<e.get("total")-1?e.next():e.scrollToIndex(0)},_handleResponse:function(t){var r=t.photoset.photo,i=this.get("srcNode"),s=this.get("_photoSizeParam"),o=e.Node.create(this.imageCarouselTemplate),u=s.split("_")[1],a=this.get("width"),f=this.get("photoSize").y+"px",l="",c,h,p,d;this.set("photos",r);for(d=0;d<r.length;d++)c=r[d],h=c["width_"+u],p=c["height_"+u],h>a&&(h=a,p*=a/h),l+=n(this.imageTemplate,{width:this.get("width"),src:c[s],title:c.title,imgWidth:h,imgHeight:p,prevNavTemplate:n(this.prevNavTemplate,{height:f}),nextNavTemplate:n(this.nextNavTemplate,{height:f}),descriptionTemplate:n(this.descriptionTemplate,{description:c.description._content})});o.setHTML(l),i.setHTML(o),this.render()},_checkForAutoAdvance:function(){this.get("autoAdvance")===!0&&e.later(this.get("startDelay"),this,function(){this.get("pauseOnHover")!==!0&&this._advanceImage(),e.later(this.get("advanceDelay"),this,function(){this.get("pauseOnHover")!==!0&&this._advanceImage()},null,!0)})},_pauseAutoAdvance:function(e){e.type==="mouseenter"?this.set("pauseOnHover",!0):this.set("pauseOnHover",!1)},bindUI:function(){e.FlickrCarousel.superclass.bindUI.apply(this);var t=this.get("_events"),n=this.get("boundingBox");t.push(n.delegate("click",this._handleCarouselNavigate,".navigate",this)),t.push(this.after("render",this._checkForAutoAdvance,this)),t.push(n.on("mouseenter",this._pauseAutoAdvance,this)),t.push(n.on("mouseleave",this._pauseAutoAdvance,this))},destructor:function(){e.Array.each(this.get("_events"),function(e){e.detach()})}},{ATTRS:{apiKey:{},photosetId:{},autoAdvance:{value:!0},startDelay:{value:3e3},advanceDelay:{value:3e3},pauseOnHover:{value:!1},flick:{value:!1},photos:{value:[]},showDescription:{value:!0},drag:{value:!1},photoSize:{value:{}},_photoSizeParam:{value:"url_m",setter:function(e){return"url_"+e}},_events:{value:[]}}})},"0.2.0",{requires:["scrollview","scrollview-paginator","base-build","jsonp","event-mouseenter"],skinnable:!1});
